Instructions on how to get a copy of the AppleTV boot.efi file

= Introduction =

During power-on boot, AppleTV efi firmware finds and executes the file boot.efi on a "Recovery" or "OSBoot" partition. This boot.efi file is responsible for loading the mach kernel and kexc drivers using com.apple.Boot.plist. It must be the original AppleTV boot.efi as it is signed and efi firmware checks the certificate and will rejected a "bad" boot.efi file. So for atv-bootlaoder to work, you need a copy of boot.efi. This raises the chicken-or-egg question of how do you get boot.efi without opening the AppleTV and removing the hard drive.

The solution is simple, extract it from the AppleTV update. The following instructions detail how to download the AppleTV 1.1 update and extract boot.efi using dmg2img. This is the only file required to enable atv-bootloader to boot linux so unless you are interested in building a [BuildingPatchstick patchstick], you can delete the downloaded/converted files.

*This needs to be done using an installed/working Linux distro and not a LiveCD. Some LiveCD distros use unionfs and loopfs does not work under a unionfs mount mount.*

= Details =

* download the update and extract boot.efi
{{{
# install some required tools to build dmg2img
#
sudo apt-get install build-essential zlib1g-dev

# download and built dmg2img
wget http://atv-bootloader.googlecode.com/files/atv-dmg2img-1.0.tar.gz
tar -xzf atv-dmg2img-1.0.tar.gz
cd dmg2img
sudo ./install_dmg2img.sh

# download the AppleTV r1.1 update
wget http://mesu.apple.com/data/OS/061-2988.20070620.bHy75/2Z694-5248-45.dmg
#
# convert it to an img format
dmg2img 2Z694-5248-45.dmg atv.img

# create a mount point
mkdir atv-update

# mount the converted img
sudo mount -o loop -t hfsplus atv.img atv-update

# extract boot.efi
sudo cp -ap atv-update/System/Library/CoreServices/boot.efi ./

# check that boot.efi looks good, the time stamp might be different.
# It is the permissions and byte count that are important.
ls -l boot.efi
# Mine reports "-rw-r--r-- 1 root    root       298800 2007-06-19 00:47 boot.efi"

# and 
md5sum boot.efi
280323d8700e4cfef15116f7e50590e3  boot.efi
}}}

* cleanup (if you are not building a patchstick)
{{{
sudo umount atv-update
rmdir atv-update
rm atv.img
rm 2Z694-5248-45.dmg
}}}